<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scale Quiz - Alterazioni Scale Maggiori</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1a202c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Scale Quiz">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU2NhbGUgUXVpeiAtIEFsdGVyYXppb25pIFNjYWxlIE1hZ2dpb3JpIiwic2hvcnRfbmFtZSI6IlNjYWxlIFF1aXoiLCJzdGFydF91cmwiOiIuIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMjAyYyIsInRoZW1lX2NvbG9yIjoiIzFhMjAyYyIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUI0Yld4dWN6MGlhSFIwY0RvdkwzZDNkeTUzTXk1dmNtY3ZNakF3TUM5emRtY2lJSFpwWlhkQ2IzZzlJakFnTUNBek1qQWdNekl3SWo0S1BISmxZM1FnZUQwaU1DSWdlVDBpTUNJZ2QybGtkR2c5SWpNeU1DSWdhR1ZwWjJoMFBTSXpNakFpSUdacGJHdzlJaU14WVRJd01tTWlMejRLUEhCaGRHZ2daRDBpVFRFMk1DQTROREJqTFRndU1qUWdNQzB4TlM0Mk5TMDNMakkySURFdU56UXRNVFl1TjJNeE1TNDVNeTB4TUM0M05DQXlOaTAzTGpJMklERTJMamN0TVRjZ01UQXVOelF0T1M0NU5pQXlOUzQyTFRjdU1qWWdNVFl1TnkweE5DQXhNQzQzTkMwNU9TNHpNeUF5TlM0MkxUY3VNall0TVRZdU55QXhOQzB4TUM0M05DQTVPUzR6TXlBeU5TNDJJRGN1TWpZZ01UWXVOeTB4TkNBeE1DNDNOQzA1T1M0ek15QXlOUzQyTFRjdU1qWWdNVFl1TnlBeE5DQXhNQzQzTkNBNU9TNHpNeUF5TlM0MmVpSmliemtzSW1acGJHdzlJaU00WmpZd1pqWWlMejRLUEhCaGRHZ2daRDBpVFRFM01pQXhOemxzTkRFdU5qWWdOakZzTFRVdU56Z3RNVEZzTFRZekxqUTNMVEUyTGprd05TMDBMVEl6YUVFeE5qQWdNVFkxWXkwNExqSTBJREF0TVRVdU5qVXROeTR5TmkweE5DNDBOUzB4Tmk0M1l5MHhNUzQ1TXlBeE1DNDNOQzB5TmlBM0xqSTJMVEUyTGpjZ01UY2dNVEF1TnpRZ09TNDVOaUF5TlM0MklEY3VNall0TVRZdU55QXhOQ0F4TUM0M05DNDFPWGdpSUdOc2FYQXRjblZzWlQwaVpYWmxibTlrWkNJZ1ptbHNiRDBpSWpobVpqY3dPVGNpTHo0S1BDOXpkbWMrIiwic2l6ZXMiOiIzMjB4MzIwIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwifV19">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzMjAgMzIwIj4KPHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjMyMCIgaGVpZ2h0PSIzMjAiIGZpbGw9IiMxYTIwMmMiLz4KPHBhdGggZD0iTTE2MCA4NDBjLTguMjQgMC0xNS42NS03LjI2IDE3LTE2LjdjMTEuOTMtMTAuNzQgMjYtNy4yNiAxNi43LTE0IDEwLjc0LTkuOTYgMjUuNi03LjI2IDE2LjctMTQgMTAuNzQtOS45NiAyNS42LTcuMjYtMTYuNyAxNCAxMC43NC05LjkzIDI1LjYtNy4yNiAxNi43LTE0IDEwLjc0LTkuOTYgMjUuNi03LjI2IDE2LjcgMTQgMTAuNzQtOS45NiAyNS42LTcuMjYtMTYuNyAxNHoiIGZpbGw9IiM4ZjYwZjYiLz4KPHBhdGggZD0iTTE3MiAxNzlsNDEuNjYgNjFsLTUuNzgtMTFsLTYzLjQ3LTE2LjkwNS00LTIzaDE2MCAyNjVjLTguMjQgMC0xNS42NS03LjI2LTE0LjQ1LTE2LjdjLTExLjkzIDEwLjc0LTI2IDcuMjYtMTYuNyAxNyAxMC43NCA5Ljk2IDI1LjYgNy4yNi0xNi43IDE0IDEwLjc0IDkuOTYgMjUuNiA3LjI2LjU5eCIgY2xpcC1ydWxlPSJldmVub2RkIiBmaWxsPSIjOGZmNzA5NyIvPgo8L3N2Zz4=">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-top: 20px;
        }

        .title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin-bottom: 20px;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .score-item {
            text-align: center;
        }

        .score-label {
            font-size: 0.8rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .score-value {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .question-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .question {
            font-size: 1.3rem;
            text-align: center;
            margin-bottom: 25px;
            font-weight: 600;
            line-height: 1.4;
        }

        .answers {
            display: grid;
            gap: 15px;
        }

        .answer-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .answer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
        }

        .answer-btn.correct {
            background: rgba(46, 213, 115, 0.8);
            border-color: #2ed573;
            animation: pulse 0.6s ease-in-out;
        }

        .answer-btn.incorrect {
            background: rgba(255, 107, 107, 0.8);
            border-color: #ff6b6b;
            animation: shake 0.6s ease-in-out;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .next-btn {
            width: 100%;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border: none;
            border-radius: 15px;
            padding: 15px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(255, 107, 107, 0.3);
        }

        .next-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
        }

        .next-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .completion-card {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            animation: slideIn 0.5s ease-out;
        }

        .completion-title {
            font-size: 2rem;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .final-score {
            font-size: 1.5rem;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .restart-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            color: white;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }

        .restart-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .install-prompt {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: none;
        }

        .install-btn {
            background: linear-gradient(45deg, #00b894, #00cec9);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .title {
                font-size: 1.7rem;
            }
            
            .question-card {
                padding: 25px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="install-prompt" id="installPrompt">
            <div>📱 Aggiungi alla Home Screen per un'esperienza migliore!</div>
            <button class="install-btn" onclick="showInstallInstructions()">Installa App</button>
        </div>

        <div class="header">
            <div class="title">🎵 Scale Quiz</div>
            <div class="subtitle">Quiz completo: alterazioni ⇄ scale maggiori</div>
        </div>

        <div class="score-board">
            <div class="score-item">
                <div class="score-label">Corrette</div>
                <div class="score-value" id="correct">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">Totali</div>
                <div class="score-value" id="total">0</div>
            </div>
            <div class="score-item">
                <div class="score-label">%</div>
                <div class="score-value" id="percentage">0</div>
            </div>
        </div>

        <div id="quizContainer">
            <!-- Quiz questions will be inserted here -->
        </div>
    </div>

    <script>
        // Database delle scale maggiori e loro alterazioni
        const scales = {
            'Do': { sharps: 0, flats: 0, alterations: [] },
            'Sol': { sharps: 1, flats: 0, alterations: ['Fa#'] },
            'Re': { sharps: 2, flats: 0, alterations: ['Fa#', 'Do#'] },
            'La': { sharps: 3, flats: 0, alterations: ['Fa#', 'Do#', 'Sol#'] },
            'Mi': { sharps: 4, flats: 0, alterations: ['Fa#', 'Do#', 'Sol#', 'Re#'] },
            'Si': { sharps: 5, flats: 0, alterations: ['Fa#', 'Do#', 'Sol#', 'Re#', 'La#'] },
            'Fa#': { sharps: 6, flats: 0, alterations: ['Fa#', 'Do#', 'Sol#', 'Re#', 'La#', 'Mi#'] },
            'Do#': { sharps: 7, flats: 0, alterations: ['Fa#', 'Do#', 'Sol#', 'Re#', 'La#', 'Mi#', 'Si#'] },
            'Fa': { sharps: 0, flats: 1, alterations: ['Sib'] },
            'Sib': { sharps: 0, flats: 2, alterations: ['Sib', 'Mib'] },
            'Mib': { sharps: 0, flats: 3, alterations: ['Sib', 'Mib', 'Lab'] },
            'Lab': { sharps: 0, flats: 4, alterations: ['Sib', 'Mib', 'Lab', 'Reb'] },
            'Reb': { sharps: 0, flats: 5, alterations: ['Sib', 'Mib', 'Lab', 'Reb', 'Solb'] },
            'Solb': { sharps: 0, flats: 6, alterations: ['Sib', 'Mib', 'Lab', 'Reb', 'Solb', 'Dob'] },
            'Dob': { sharps: 0, flats: 7, alterations: ['Sib', 'Mib', 'Lab', 'Reb', 'Solb', 'Dob', 'Fab'] }
        };

        let currentQuestion = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let questions = [];
        let currentQuestionData = null;

        // Statistiche
        let stats = {
            correct: 0,
            total: 0
        };

        // Carica statistiche salvate
        function loadStats() {
            const saved = JSON.parse(localStorage.getItem('scaleQuizStats') || '{"correct": 0, "total": 0}');
            stats = saved;
            updateScoreDisplay();
        }

        // Salva statistiche
        function saveStats() {
            localStorage.setItem('scaleQuizStats', JSON.stringify(stats));
        }

        // Genera domande casuali
        function generateQuestions(count = 10) {
            questions = [];
            const scaleNames = Object.keys(scales);
            
            for (let i = 0; i < count; i++) {
                const questionType = Math.random() < 0.33 ? 'alterations' : 
                                   Math.random() < 0.5 ? 'count' : 'reverse';
                const scaleName = scaleNames[Math.floor(Math.random() * scaleNames.length)];
                const scale = scales[scaleName];
                
                if (questionType === 'alterations') {
                    // Domanda sulle alterazioni specifiche
                    const question = `Quali sono le alterazioni della scala di ${scaleName} maggiore?`;
                    const correctAnswer = scale.alterations.length > 0 ? scale.alterations.join(', ') : 'Nessuna alterazione';
                    
                    // Genera risposte sbagliate
                    const wrongAnswers = generateWrongAlterations(scale.alterations);
                    
                    questions.push({
                        question,
                        correct: correctAnswer,
                        answers: shuffleArray([correctAnswer, ...wrongAnswers])
                    });
                } else if (questionType === 'count') {
                    // Domanda sul numero di alterazioni
                    const question = `Quante alterazioni ha la scala di ${scaleName} maggiore?`;
                    const totalAlterations = scale.sharps + scale.flats;
                    const correctAnswer = totalAlterations === 0 ? 'Nessuna alterazione' : 
                                        totalAlterations === 1 ? '1 alterazione' : 
                                        `${totalAlterations} alterazioni`;
                    
                    // Genera risposte sbagliate
                    const wrongAnswers = generateWrongCounts(totalAlterations);
                    
                    questions.push({
                        question,
                        correct: correctAnswer,
                        answers: shuffleArray([correctAnswer, ...wrongAnswers])
                    });
                } else {
                    // Domanda inversa: dalle alterazioni alla scala
                    const alterationsText = scale.alterations.length > 0 ? 
                        scale.alterations.join(', ') : 'nessuna alterazione';
                    const question = scale.alterations.length > 0 ? 
                        `A quale scala maggiore appartengono le seguenti alterazioni: ${alterationsText}?` :
                        `Quale scala maggiore non ha alterazioni?`;
                    const correctAnswer = scaleName;
                    
                    // Genera risposte sbagliate
                    const wrongAnswers = generateWrongScales(scaleName, scaleNames);
                    
                    questions.push({
                        question,
                        correct: correctAnswer,
                        answers: shuffleArray([correctAnswer, ...wrongAnswers])
                    });
                }
            }
        }

        function generateWrongScales(correctScale, allScales) {
            const wrong = [];
            const shuffledScales = shuffleArray(allScales.filter(scale => scale !== correctScale));
            
            // Prendi le prime 3 scale diverse da quella corretta
            for (let i = 0; i < 3 && i < shuffledScales.length; i++) {
                wrong.push(shuffledScales[i]);
            }
            
            return wrong;
        }

        function generateWrongAlterations(correctAlterations) {
            const allAlterations = ['Fa#', 'Do#', 'Sol#', 'Re#', 'La#', 'Mi#', 'Si#', 'Sib', 'Mib', 'Lab', 'Reb', 'Solb', 'Dob', 'Fab'];
            const wrong = [];
            
            // Genera 3 risposte sbagliate
            while (wrong.length < 3) {
                if (Math.random() < 0.3 && correctAlterations.length > 0) {
                    // A volte usa "Nessuna alterazione" come risposta sbagliata
                    const candidate = 'Nessuna alterazione';
                    if (!wrong.includes(candidate) && correctAlterations.length > 0) {
                        wrong.push(candidate);
                    }
                } else {
                    // Genera combinazioni casuali di alterazioni
                    const numAlterations = Math.floor(Math.random() * 6) + 1;
                    const randomAlterations = [];
                    const shuffled = shuffleArray([...allAlterations]);
                    
                    for (let i = 0; i < numAlterations && i < shuffled.length; i++) {
                        randomAlterations.push(shuffled[i]);
                    }
                    
                    const candidate = randomAlterations.join(', ');
                    if (!wrong.includes(candidate) && candidate !== correctAlterations.join(', ')) {
                        wrong.push(candidate);
                    }
                }
            }
            
            return wrong;
        }

        function generateWrongCounts(correctCount) {
            const wrong = [];
            const possibleCounts = [0, 1, 2, 3, 4, 5, 6, 7];
            
            for (let count of possibleCounts) {
                if (count !== correctCount && wrong.length < 3) {
                    const answer = count === 0 ? 'Nessuna alterazione' : 
                                  count === 1 ? '1 alterazione' : 
                                  `${count} alterazioni`;
                    wrong.push(answer);
                }
            }
            
            return wrong.slice(0, 3);
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function displayQuestion() {
            if (currentQuestion >= questions.length) {
                showCompletion();
                return;
            }

            currentQuestionData = questions[currentQuestion];
            const container = document.getElementById('quizContainer');
            
            container.innerHTML = `
                <div class="question-card">
                    <div class="question">${currentQuestionData.question}</div>
                    <div class="answers">
                        ${currentQuestionData.answers.map((answer, index) => 
                            `<button class="answer-btn" onclick="selectAnswer('${answer.replace(/'/g, "\\'")}', this)">${answer}</button>`
                        ).join('')}
                    </div>
                    <button class="next-btn" id="nextBtn" onclick="nextQuestion()" disabled>Prossima Domanda</button>
                </div>
            `;
        }

        function selectAnswer(selectedAnswer, button) {
            const buttons = document.querySelectorAll('.answer-btn');
            const nextBtn = document.getElementById('nextBtn');
            
            // Disabilita tutti i pulsanti
            buttons.forEach(btn => btn.style.pointerEvents = 'none');
            
            // Mostra la risposta corretta e quella sbagliata
            buttons.forEach(btn => {
                if (btn.textContent === currentQuestionData.correct) {
                    btn.classList.add('correct');
                } else if (btn === button && btn.textContent !== currentQuestionData.correct) {
                    btn.classList.add('incorrect');
                }
            });
            
            // Aggiorna statistiche
            stats.total++;
            totalQuestions++;
            
            if (selectedAnswer === currentQuestionData.correct) {
                correctAnswers++;
                stats.correct++;
            }
            
            updateScoreDisplay();
            saveStats();
            
            // Abilita il pulsante "Prossima"
            nextBtn.disabled = false;
        }

        function nextQuestion() {
            currentQuestion++;
            displayQuestion();
        }

        function updateScoreDisplay() {
            document.getElementById('correct').textContent = stats.correct;
            document.getElementById('total').textContent = stats.total;
            document.getElementById('percentage').textContent = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
        }

        function showCompletion() {
            const container = document.getElementById('quizContainer');
            const percentage = totalQuestions > 0 ? Math.round((correctAnswers / totalQuestions) * 100) : 0;
            
            let message = '';
            if (percentage >= 90) message = '🎉 Eccellente! Sei un maestro delle scale!';
            else if (percentage >= 75) message = '👏 Molto bene! Ottima conoscenza!';
            else if (percentage >= 60) message = '👍 Buon lavoro! Continua a praticare!';
            else message = '📚 Continua a studiare, migliorerai!';
            
            container.innerHTML = `
                <div class="completion-card">
                    <div class="completion-title">Quiz Completato!</div>
                    <div class="final-score">
                        Hai risposto correttamente a ${correctAnswers} domande su ${totalQuestions}<br>
                        <strong>${percentage}%</strong>
                    </div>
                    <div style="margin-bottom: 20px;">${message}</div>
                    <button class="restart-btn" onclick="startNewQuiz()">Nuovo Quiz</button>
                </div>
            `;
        }

        function startNewQuiz() {
            currentQuestion = 0;
            correctAnswers = 0;
            totalQuestions = 0;
            generateQuestions(10);
            displayQuestion();
        }

        // PWA Installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        function showInstallInstructions() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        document.getElementById('installPrompt').style.display = 'none';
                    }
                    deferredPrompt = null;
                });
            } else {
                // Istruzioni per iOS
                alert('Per aggiungere questa app alla home screen:\n\n1. Tocca l\'icona di condivisione nel browser\n2. Scorri e tocca "Aggiungi alla schermata Home"\n3. Tocca "Aggiungi"');
            }
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'scale-quiz-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', (event) => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then((cache) => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', (event) => {
                        event.respondWith(
                            caches.match(event.request)
                                .then((response) => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Inizializzazione
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            startNewQuiz();
            
            // Nascondi il prompt di installazione dopo qualche secondo se non supportato
            setTimeout(() => {
                if (!deferredPrompt && !window.navigator.standalone) {
                    // Mostra il prompt per dispositivi iOS
                    if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
                        document.getElementById('installPrompt').style.display = 'block';
                    }
                }
            }, 3000);
        });

        // Prevenire il refresh accidentale
        window.addEventListener('beforeunload', (e) => {
            if (currentQuestion > 0 && currentQuestion < questions.length) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Gestione della modalità fullscreen su iOS
        if (window.navigator.standalone) {
            document.body.style.paddingTop = '44px'; // Status bar height
        }
    </script>
</body>
</html>
